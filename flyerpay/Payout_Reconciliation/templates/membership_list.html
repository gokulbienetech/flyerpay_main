{% load static %}
<!doctype html>

<html
  lang="en"
  class="layout-navbar-fixed layout-menu-fixed layout-compact"
  dir="ltr"
  data-skin="default"
  data-static-path="../../static/"
  data-template="vertical-menu-template-starter"
  data-bs-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>Demo: FlyerPay</title>

    <meta name="description" content="" />
    <!-- Bootstrap icon cdn -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../../static/img/favicon/favicon.ico" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&ampdisplay=swap"
      rel="stylesheet" />

    <link rel="stylesheet" href="../../static/vendor/fonts/iconify-icons.css" />

    <!-- Core CSS -->
    <!-- build:css static/vendor/css/theme.css  -->

    <link rel="stylesheet" href="../../static/vendor/libs/node-waves/node-waves.css" />

    <link rel="stylesheet" href="../../static/vendor/libs/pickr/pickr-themes.css" />

    <link rel="stylesheet" href="../../static/vendor/css/core.css" />
    <link rel="stylesheet" href="../../static/css/demo.css" />

    <!-- Vendors CSS -->

    <link rel="stylesheet" href="../../static/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />

    <!-- endbuild -->

    <!-- Page CSS -->

    <!-- Helpers -->
    <script src="../../static/vendor/js/helpers.js"></script>
    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->

    <!--? Template customizer: To hide customizer set displayCustomizer value false in config.js.  -->
    <script src="../../static/vendor/js/template-customizer.js"></script>

    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->

    <script src="../../static/js/config.js"></script>
  </head>

  <style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 50px;
    }
    .container {
        display: flex;
        justify-content: space-between;
        max-width: 600px;
        margin: auto;
    }
    .box {
        width: 45%;
        padding: 20px;
        border: 2px solid #ddd;
        border-radius: 10px;
    }
    .btn-container {
        margin-top: 20px;
    }
    .btn {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        cursor: pointer;
    }
    .btn-primary {
        background-color: #007bff;
        color: white;
    }
    .btn-success {
        background-color: #28a745;
        color: white;
    }
    .btn-danger {
        background-color: #dc3545;
        color: white;
    }
    table {
        width: 80%;
        margin: 20px auto;
        border-collapse: collapse;
    }
    th, td {
        padding: 10px;
        border: 1px solid #ddd;
    }
    th {
        background-color: #f4f4f4;
    }
    #full_membership_table th{
      text-align: center; /* Center the column header */
    }

    
    #full_membership_table td {
        text-align: center; /* Align data properly */
        padding: 5px 10px; /* Adjust padding for better readability */
    }
    .filter-container {
        margin: 20px auto;
        display: flex;
        justify-content: center;
        gap: 10px;
    }

    #add-membership-form {
        display: none;
        margin-top: 20px;
        {% comment %} padding: 10px; {% endcomment %}
        {% comment %} border: 1px solid #ddd; {% endcomment %}
        {% comment %} border-radius: 5px; {% endcomment %}
        width: 50%;
    }
    .hidden { display: none; }
</style>

  <body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->

        <aside id="layout-menu" class="layout-menu menu-vertical menu">
          <div class="app-brand demo">
            <a href="{% url 'home_page' %}" class="app-brand-link">
              <span class="app-brand-logo demo">
                <span class="text-primary">
                  {% comment %} <svg width="32" height="22" viewBox="0 0 32 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M0.00172773 0V6.85398C0.00172773 6.85398 -0.133178 9.01207 1.98092 10.8388L13.6912 21.9964L19.7809 21.9181L18.8042 9.88248L16.4951 7.17289L9.23799 0H0.00172773Z"
                      fill="currentColor" />
                    <path
                      opacity="0.06"
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M7.69824 16.4364L12.5199 3.23696L16.5541 7.25596L7.69824 16.4364Z"
                      fill="#161616" />
                    <path
                      opacity="0.06"
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M8.07751 15.9175L13.9419 4.63989L16.5849 7.28475L8.07751 15.9175Z"
                      fill="#161616" />
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M7.77295 16.3566L23.6563 0H32V6.88383C32 6.88383 31.8262 9.17836 30.6591 10.4057L19.7824 22H13.6938L7.77295 16.3566Z"
                      fill="currentColor" />
                  </svg> {% endcomment %}
                </span>
              </span>
              <span class="app-brand-text demo menu-text fw-bold ms-3"><img src="{% static 'img/logo/logo.png' %}" alt="Logo" style="height: 70px; width:70px; margin-top:10px;  margin-right: 10px;"></span>
            </a>

            <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto">
              <i class="icon-base ti menu-toggle-icon d-none d-xl-block"></i>
              <i class="icon-base ti tabler-x d-block d-xl-none"></i>
            </a>
          </div>

          <div class="menu-inner-shadow"></div>

          <ul class="menu-inner py-1">
            <!-- Page -->
            <li class="menu-item ">
              <a href="{% url 'home_page' %}" class="menu-link">
                <i class="menu-icon icon-base ti tabler-smart-home"></i>
                <div data-i18n="Page 1">Home</div>
              </a>
            </li>
            <li class="menu-item">
              <a href="{% url 'client_details_view' %}" class="menu-link">
                <i class="menu-icon icon-base ti tabler-app-window"></i>
                <div data-i18n="Page 2">Merchant Onboarding</div>
              </a>
            </li>
            <li class="menu-item ">
                <a href="{% url 'upload_excel' %}" class="menu-link">
                  <i class="menu-icon icon-base ti tabler-app-window"></i>
                  <div data-i18n="Page 3">Payout Reconciliation Process</div>
                </a>
              </li>
            <li class="menu-item active">
                <a href="{% url 'membership_list' %}" class="menu-link">
                  <i class="menu-icon icon-base ti tabler-app-window"></i>
                  <div data-i18n="Page 3">Membership</div>
                </a>
              </li>
            <li class="menu-item ">
                <a href="{% url 'aggregator_list' %}" class="menu-link">
                  <i class="menu-icon icon-base ti tabler-app-window"></i>
                  <div data-i18n="Page 3">Aggregator</div>
                </a>
              </li>
            <li class="menu-item ">
                <a href="{% url 'log_page' %}" class="menu-link">
                  <i class="menu-icon icon-base ti tabler-app-window"></i>
                  <div data-i18n="Page 3">Logs</div>
                </a>
              </li>
          </ul>
        </aside>

        <div class="menu-mobile-toggler d-xl-none rounded-1">
          <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large text-bg-secondary p-2 rounded-1">
            <i class="ti tabler-menu icon-base"></i>
            <i class="ti tabler-chevron-right icon-base"></i>
          </a>
        </div>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->
          <nav
          class="layout-navbar container-xxl  navbar navbar-expand-xl align-items-center "
          id="layout-navbar">
          <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
            <!-- <a class="nav-item nav-link px-0 me-xl-6" href="javascript:void(0)">
              <i class="icon-base ti tabler-menu-2 icon-md"></i>
            </a> -->
          </div>

          
        </nav>

       
          <!-- / Navbar -->

          <!-- Content wrapper -->
          <div class="content-wrapper">
            <!-- Content -->
           
            <h2>Membership Management</h2>
             <!-- Add Membership Button -->
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button id="toggle-add-form" class="btn btn-success">Add Membership</button>
            </div>
    <!-- Membership Table -->
    <table class="table table-bordered" id="full_membership_table">
        <thead>
            <tr>
                <th>Membership Type</th>
                <th>Total Amount (Rs.)</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="membership-table">
            {% for membership in memberships %}
            <tr id="row-{{ membership.id }}">
                <td>{{ membership.membership_type }}</td>
                <td>{{ membership.total_amount }}</td>
                <td>
                    <button class="edit-btn  btn btn-warning btn-sm " data-id="{{ membership.id }}" data-type="{{ membership.membership_type }}" data-amount="{{ membership.total_amount }}"><i class="bi bi-pencil-square"></i></button>
                    <button class="delete-btn btn btn-danger btn-sm" data-id="{{ membership.id }}"><i class="bi bi-trash3"></i></button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

   


    <!-- Add Membership Form (Initially Hidden) -->
    {% comment %} <div id="add-membership-form" class="mb-4">
        <h3>Add Membership</h3>
        <label>Membership Type:</label>
        <select id="membership-type">
            <option value="Monthly">Monthly</option>
            <option value="Yearly">Yearly</option>
            <option value="One Time">One Time</option>
        </select><br><br>

        <label>Total Amount (Rs.):</label>
        <input type="number" id="total-amount"><br><br>
        
        

        <button type="submit" class="btn btn-success" id="submit-membership">Submit</button>
        <button type="button" class="btn btn-secondary" id="cancel-add">Cancel</button>

       
    </div> {% endcomment %}

    <div id="membershipFormContainer" style="display: none;" class="mt-3">
        <form id="membershipForm" method="post">
            {% csrf_token %}
            <input type="hidden" id="membership_id" name="membership_id">
            <div class="row">
                <div class="col-md-3">{{ form.membership_type.label_tag }} {{ form.membership_type }}</div>
                <div class="col-md-3">{{ form.total_amount.label_tag }} {{ form.total_amount }}</div>
                <div>
                    <button type="submit" class="btn btn-success" id="submitBtn">Submit</button>
                    <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
                </div>
            </div>
        </form>
    </div>
    

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    


    <script>

        $(document).ready(function () {
            console.log("JavaScript Loaded!");
        
            // Show/Hide Add Membership Form
            $("#toggle-add-form").click(function () {
                $("#membershipFormContainer").fadeIn();  // Ensure form is shown
                resetForm();
            });
        
            // Cancel Adding Membership
            $("#cancelBtn").click(function () {
                $("#membershipFormContainer").fadeOut(); // Hide the form
                resetForm();
            });
        
            // Submit New Membership via AJAX
            $("#submitBtn").click(function (e) {
                e.preventDefault();
        
                let membershipType = $("#id_membership_type").val();
                let totalAmount = $("#id_total_amount").val();
        
                $.ajax({
                    url: "{% url 'membership_add' %}",
                    type: "POST",
                    data: {
                        membership_type: membershipType,
                        total_amount: totalAmount,
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function (response) {
                        if (response.success) {
                            Swal.fire('Success', response.message, 'success').then(() => location.reload());
                        } else {
                            Swal.fire('Error', response.message, 'error');
                        }
                    }
                });
            });
        
            // Edit Membership
            $(".edit-btn").click(function () {
                let membershipId = $(this).data("id");
                let membershipType = $(this).data("type");
                let totalAmount = $(this).data("amount");
        
                $("#id_membership_type").val(membershipType);
                $("#id_total_amount").val(totalAmount);
                $("#membership_id").val(membershipId);
                $("#membershipFormContainer").fadeIn(); // Show the form
        
                $("#submitBtn").off().click(function (e) {
                    e.preventDefault();
        
                    $.ajax({
                        url: `/memberships/edit/${membershipId}/`,
                        type: "POST",
                        data: {
                            membership_type: $("#id_membership_type").val(),
                            total_amount: $("#id_total_amount").val(),
                            csrfmiddlewaretoken: '{{ csrf_token }}'
                        },
                        success: function (response) {
                            if (response.success) {
                                Swal.fire('Success', response.message, 'success').then(() => location.reload());
                            } else {
                                Swal.fire('Error', response.message, 'error');
                            }
                        }
                    });
                });
            });
        
            // Delete Membership
            $(".delete-btn").click(function () {
                let membershipId = $(this).data("id");
        
                Swal.fire({
                    title: 'Are you sure?',
                    text: "This will soft-delete the membership!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes, delete it!',
                    cancelButtonText: 'No, cancel!',
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.post(`/memberships/delete/${membershipId}/`, {
                            csrfmiddlewaretoken: '{{ csrf_token }}'
                        }, function (response) {
                            if (response.success) {
                                Swal.fire('Deleted!', response.message, 'success').then(() => location.reload());
                            }
                        });
                    }
                });
            });
        
            function resetForm() {
                $("#id_membership_type").val("");
                $("#id_total_amount").val("");
                $("#membership_id").val("");
            }
        });
        
    </script>



    {% comment %} <script>
        $(document).ready(function() {

            // Show/Hide Add Membership Form
            $("#toggle-add-form").click(function() {
                $("#add-membership-form").toggle();
            });

            // Cancel Adding Membership
            $("#cancel-add").click(function() {
                $("#add-membership-form").hide();
            });

            // Submit New Membership via AJAX
            $("#submit-membership").click(function() {
                let membershipType = $("#membership-type").val();
                let totalAmount = $("#total-amount").val();

                $.post("{% url 'membership_add' %}", {
                    membership_type: membershipType,
                    total_amount: totalAmount,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                }, function(response) {
                    if (response.success) {
                        Swal.fire('Success', response.message, 'success').then(() => location.reload());
                    } else {
                        Swal.fire('Error', response.message, 'error');
                    }
                });
            });

            // Edit Membership
            $(".edit-btn").click(function() {
                let membershipId = $(this).data('id');
                let membershipType = $(this).data('type');
                let totalAmount = $(this).data('amount');

                $("#membership-type").val(membershipType);
                $("#total-amount").val(totalAmount);
                $("#add-membership-form").show();

                $("#submit-membership").off().click(function() {
                    $.post(`/memberships/edit/${membershipId}/`, {
                        membership_type: $("#membership-type").val(),
                        total_amount: $("#total-amount").val(),
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    }, function(response) {
                        if (response.success) {
                            Swal.fire('Success', response.message, 'success').then(() => location.reload());
                        } else {
                            Swal.fire('Error', response.message, 'error');
                        }
                    });
                });
            });

            // Delete Membership with SweetAlert Confirmation
            $(".delete-btn").click(function() {
                let membershipId = $(this).data('id');

                Swal.fire({
                    title: 'Are you sure?',
                    text: "This will soft-delete the membership!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes, delete it!',
                    cancelButtonText: 'No, cancel!',
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.post(`/memberships/delete/${membershipId}/`, {
                            csrfmiddlewaretoken: '{{ csrf_token }}'
                        }, function(response) {
                            if (response.success) {
                                Swal.fire('Deleted!', response.message, 'success').then(() => location.reload());
                            } else {
                                Swal.fire('Error', response.message, 'error');
                            }
                        });
                    }
                });
            });

        });
    </script> {% endcomment %}
            
            
         

            
            <!-- / Content -->
   
            <!-- Footer -->
            <footer class="content-footer footer bg-footer-theme">
              <div class="container-xxl">
                <div
                  class="footer-container d-flex align-items-center justify-content-between py-4 flex-md-row flex-column">
                  <div class="text-body">
                    ©
                    <script>
                      document.write(new Date().getFullYear());
                    </script>
                    <!-- , made with ❤️ by <a href="https://pixinvent.com" target="_blank" class="footer-link">Pixinvent</a> -->
                  </div>
                  
                </div>
              </div>
            </footer>
            <!-- / Footer -->

            <div class="content-backdrop fade"></div>
          </div>
          <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>

      <!-- Drag Target Area To SlideIn Menu On Small Screens -->
      <div class="drag-target"></div>
    </div>
    <!-- / Layout wrapper -->

    <!-- Core JS -->
    <!-- build:js static/vendor/js/theme.js -->

    <script src="../../static/vendor/libs/jquery/jquery.js"></script>

    <script src="../../static/vendor/libs/popper/popper.js"></script>
    <script src="../../static/vendor/js/bootstrap.js"></script>
    <script src="../../static/vendor/libs/node-waves/node-waves.js"></script>

    <script src="../../static/vendor/libs/@algolia/autocomplete-js.js"></script>

    <script src="../../static/vendor/libs/pickr/pickr.js"></script>

    <script src="../../static/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>

    <script src="../../static/vendor/libs/hammer/hammer.js"></script>

    <script src="../../static/vendor/js/menu.js"></script>

    <!-- endbuild -->

    <!-- Vendors JS -->

    <!-- Main JS -->

    <script src="../../static/js/main.js"></script>

    <!-- Page JS -->
  </body>
</html>
